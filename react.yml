# Copyright 2023 OpenStax Poland
# Licensed under the MIT license. See LICENSE file in the project root for
# full license text.

# Enforce best practices and protect against common mistakes in JSX and React.
#
# This is an alternative to openstax-poland/base which includes additional rules
# from eslint-plugin-react.

extends:
  - plugin:react/recommended

settings:
  react:
    version: 16.14.0

rules:
  # Default value of type is "submit", which may cause unexpected page reloads
  react/button-has-type: error

  # Force specifying iframe sandbox, a good security practice
  react/iframe-missing-sandbox: error

  # Ensure consistent indentation in JSX props
  '@stylistic/jsx-indent-props': error

  # Require closing bracket to be aligned with properties, and closing tag with
  # opening tag.
  '@stylistic/jsx-closing-bracket-location': [error, props-aligned]

  # Disable until
  # return <tag>
  #   content
  # </tag>
  # is legal
  # '@stylistic/jsx-closing-tag-location': error

  # Disallow unnecessary curly braces in JSX.
  '@stylistic/jsx-curly-brace-presence': error

  # Enforce consistent newlines inside braces.
  '@stylistic/jsx-curly-newline': error

  # Disallow spaces inside of curly braces in JSX fragments.
  '@stylistic/jsx-curly-spacing': error

  # Disallow spaces around equals signs.
  '@stylistic/jsx-equals-spacing': error

  # In tags with multiple properties, when written over multiple lines,
  # the first tag must be on its own line.
  '@stylistic/jsx-first-prop-new-line': error

  # Prefer shorthand syntax for fragments (<>...</> rather than
  # <React.Fragment>...</React.Fragment>).
  react/jsx-fragments: error

  # Disallow multiple props on one line, except when props and tag are all on
  # the same line.
  '@stylistic/jsx-max-props-per-line':
    - error
    - when: multiline

  # Forbid use of .bind() and arrow functions as JSX callbacks, as they are not
  # comparable and can cause unnecessary re-renders.
  react/jsx-no-bind: error

  # Forbid non-stable values being used as context, as they can cause costly
  # unintentional re-renders.
  react/jsx-no-constructed-context-values: error

  # Forbid attempts at conditional rendering which may accidentally render the
  # condition instead (e.g. value && <Something />).
  react/jsx-no-leaked-render: error

  # Forbid uses of fragments with a single child element.
  react/jsx-no-useless-fragment: error

  # Require consistent spacing within JSX tags
  '@stylistic/jsx-tag-spacing':
    - error
    - beforeSelfClosing: allow

  # Disallow multiple spaces between JSX props.
  '@stylistic/jsx-props-no-multi-spaces': error

  # Warn against dangerous usage of this.state in calls to this.setState.
  react/no-access-state-in-setstate: warn

  # Forbid usages of array indexes as keys.
  react/no-array-index-key: error

  # Warn against uses of this.setState within componentDidMount and
  # componentDidUpdate, as this will trigger an additional render.
  react/no-did-mount-set-state: warn
  react/no-did-update-set-state: warn

  # Forbid uses of non-primitive values as prop defaults, as this could cause
  # infinite re-render loops.
  react/no-object-type-as-default-prop: error

  # Properties in state must be used.
  react/no-unused-state: error

  # Forbid usage of unsafe lifecycle methods.
  react/no-unsafe: error

  # Don't use shouldComponentUpdate within a React.PureComponent, as then
  # extending PureComponent is meaningless.
  react/no-redundant-should-component-update: error

  # Use of this in functional components is most likely a mistake.
  react/no-this-in-sfc: error

  # Protect against common typos.
  react/no-typos: error

  # Calling this.setState within componentWillUpdate can lead to indeterminate
  # state.
  react/no-will-update-set-state: error

  # React components must be defined as ES6 classes.
  react/prefer-es6-class: error

  # Stateless components must be written as functions.
  react/prefer-stateless-function: error

  # Disallow passing children to void DOM elements.
  react/void-dom-elements-no-children: error

  # Starting with React 17 (and 16.14) a new JSX transform was introduced, which
  # doesn't require React to be in scope.
  react/react-in-jsx-scope: off

  # Enforce use of self-closing tags whenever possible.
  react/self-closing-comp:
    - error
    - component: true
      html: true

  # Require propTypes to be sorted.
  react/sort-prop-types: error
